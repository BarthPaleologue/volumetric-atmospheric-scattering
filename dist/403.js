"use strict";(self.webpackChunkvolumetric_atmospheric_scattering=self.webpackChunkvolumetric_atmospheric_scattering||[]).push([[403],{9026:(e,a,t)=>{t.d(a,{O:()=>i,Q:()=>h});var l=t(520),r=t(2943);const s=[Math.sqrt(1/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(3/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(15/(4*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(5/(16*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(15/(16*Math.PI))],o=[()=>1,e=>e.y,e=>e.z,e=>e.x,e=>e.x*e.y,e=>e.y*e.z,e=>3*e.z*e.z-1,e=>e.x*e.z,e=>e.x*e.x-e.y*e.y],c=(e,a)=>s[e]*o[e](a),n=[Math.PI,2*Math.PI/3,2*Math.PI/3,2*Math.PI/3,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4];class i{constructor(){this.preScaled=!1,this.l00=l.Pq.Zero(),this.l1_1=l.Pq.Zero(),this.l10=l.Pq.Zero(),this.l11=l.Pq.Zero(),this.l2_2=l.Pq.Zero(),this.l2_1=l.Pq.Zero(),this.l20=l.Pq.Zero(),this.l21=l.Pq.Zero(),this.l22=l.Pq.Zero()}addLight(e,a,t){r.AA.Vector3[0].set(a.r,a.g,a.b);const l=r.AA.Vector3[0],s=r.AA.Vector3[1];l.scaleToRef(t,s),s.scaleToRef(c(0,e),r.AA.Vector3[2]),this.l00.addInPlace(r.AA.Vector3[2]),s.scaleToRef(c(1,e),r.AA.Vector3[2]),this.l1_1.addInPlace(r.AA.Vector3[2]),s.scaleToRef(c(2,e),r.AA.Vector3[2]),this.l10.addInPlace(r.AA.Vector3[2]),s.scaleToRef(c(3,e),r.AA.Vector3[2]),this.l11.addInPlace(r.AA.Vector3[2]),s.scaleToRef(c(4,e),r.AA.Vector3[2]),this.l2_2.addInPlace(r.AA.Vector3[2]),s.scaleToRef(c(5,e),r.AA.Vector3[2]),this.l2_1.addInPlace(r.AA.Vector3[2]),s.scaleToRef(c(6,e),r.AA.Vector3[2]),this.l20.addInPlace(r.AA.Vector3[2]),s.scaleToRef(c(7,e),r.AA.Vector3[2]),this.l21.addInPlace(r.AA.Vector3[2]),s.scaleToRef(c(8,e),r.AA.Vector3[2]),this.l22.addInPlace(r.AA.Vector3[2])}scaleInPlace(e){this.l00.scaleInPlace(e),this.l1_1.scaleInPlace(e),this.l10.scaleInPlace(e),this.l11.scaleInPlace(e),this.l2_2.scaleInPlace(e),this.l2_1.scaleInPlace(e),this.l20.scaleInPlace(e),this.l21.scaleInPlace(e),this.l22.scaleInPlace(e)}convertIncidentRadianceToIrradiance(){this.l00.scaleInPlace(n[0]),this.l1_1.scaleInPlace(n[1]),this.l10.scaleInPlace(n[2]),this.l11.scaleInPlace(n[3]),this.l2_2.scaleInPlace(n[4]),this.l2_1.scaleInPlace(n[5]),this.l20.scaleInPlace(n[6]),this.l21.scaleInPlace(n[7]),this.l22.scaleInPlace(n[8])}convertIrradianceToLambertianRadiance(){this.scaleInPlace(1/Math.PI)}preScaleForRendering(){this.preScaled=!0,this.l00.scaleInPlace(s[0]),this.l1_1.scaleInPlace(s[1]),this.l10.scaleInPlace(s[2]),this.l11.scaleInPlace(s[3]),this.l2_2.scaleInPlace(s[4]),this.l2_1.scaleInPlace(s[5]),this.l20.scaleInPlace(s[6]),this.l21.scaleInPlace(s[7]),this.l22.scaleInPlace(s[8])}updateFromArray(e){return l.Pq.FromArrayToRef(e[0],0,this.l00),l.Pq.FromArrayToRef(e[1],0,this.l1_1),l.Pq.FromArrayToRef(e[2],0,this.l10),l.Pq.FromArrayToRef(e[3],0,this.l11),l.Pq.FromArrayToRef(e[4],0,this.l2_2),l.Pq.FromArrayToRef(e[5],0,this.l2_1),l.Pq.FromArrayToRef(e[6],0,this.l20),l.Pq.FromArrayToRef(e[7],0,this.l21),l.Pq.FromArrayToRef(e[8],0,this.l22),this}updateFromFloatsArray(e){return l.Pq.FromFloatsToRef(e[0],e[1],e[2],this.l00),l.Pq.FromFloatsToRef(e[3],e[4],e[5],this.l1_1),l.Pq.FromFloatsToRef(e[6],e[7],e[8],this.l10),l.Pq.FromFloatsToRef(e[9],e[10],e[11],this.l11),l.Pq.FromFloatsToRef(e[12],e[13],e[14],this.l2_2),l.Pq.FromFloatsToRef(e[15],e[16],e[17],this.l2_1),l.Pq.FromFloatsToRef(e[18],e[19],e[20],this.l20),l.Pq.FromFloatsToRef(e[21],e[22],e[23],this.l21),l.Pq.FromFloatsToRef(e[24],e[25],e[26],this.l22),this}static FromArray(e){return(new i).updateFromArray(e)}static FromPolynomial(e){const a=new i;return a.l00=e.xx.scale(.376127).add(e.yy.scale(.376127)).add(e.zz.scale(.376126)),a.l1_1=e.y.scale(.977204),a.l10=e.z.scale(.977204),a.l11=e.x.scale(.977204),a.l2_2=e.xy.scale(1.16538),a.l2_1=e.yz.scale(1.16538),a.l20=e.zz.scale(1.34567).subtract(e.xx.scale(.672834)).subtract(e.yy.scale(.672834)),a.l21=e.zx.scale(1.16538),a.l22=e.xx.scale(1.16538).subtract(e.yy.scale(1.16538)),a.l1_1.scaleInPlace(-1),a.l11.scaleInPlace(-1),a.l2_1.scaleInPlace(-1),a.l21.scaleInPlace(-1),a.scaleInPlace(Math.PI),a}}class h{constructor(){this.x=l.Pq.Zero(),this.y=l.Pq.Zero(),this.z=l.Pq.Zero(),this.xx=l.Pq.Zero(),this.yy=l.Pq.Zero(),this.zz=l.Pq.Zero(),this.xy=l.Pq.Zero(),this.yz=l.Pq.Zero(),this.zx=l.Pq.Zero()}get preScaledHarmonics(){return this._harmonics||(this._harmonics=i.FromPolynomial(this)),this._harmonics.preScaled||this._harmonics.preScaleForRendering(),this._harmonics}addAmbient(e){r.AA.Vector3[0].copyFromFloats(e.r,e.g,e.b);const a=r.AA.Vector3[0];this.xx.addInPlace(a),this.yy.addInPlace(a),this.zz.addInPlace(a)}scaleInPlace(e){this.x.scaleInPlace(e),this.y.scaleInPlace(e),this.z.scaleInPlace(e),this.xx.scaleInPlace(e),this.yy.scaleInPlace(e),this.zz.scaleInPlace(e),this.yz.scaleInPlace(e),this.zx.scaleInPlace(e),this.xy.scaleInPlace(e)}updateFromHarmonics(e){return this._harmonics=e,this.x.copyFrom(e.l11),this.x.scaleInPlace(1.02333).scaleInPlace(-1),this.y.copyFrom(e.l1_1),this.y.scaleInPlace(1.02333).scaleInPlace(-1),this.z.copyFrom(e.l10),this.z.scaleInPlace(1.02333),this.xx.copyFrom(e.l00),r.AA.Vector3[0].copyFrom(e.l20).scaleInPlace(.247708),r.AA.Vector3[1].copyFrom(e.l22).scaleInPlace(.429043),this.xx.scaleInPlace(.886277).subtractInPlace(r.AA.Vector3[0]).addInPlace(r.AA.Vector3[1]),this.yy.copyFrom(e.l00),this.yy.scaleInPlace(.886277).subtractInPlace(r.AA.Vector3[0]).subtractInPlace(r.AA.Vector3[1]),this.zz.copyFrom(e.l00),r.AA.Vector3[0].copyFrom(e.l20).scaleInPlace(.495417),this.zz.scaleInPlace(.886277).addInPlace(r.AA.Vector3[0]),this.yz.copyFrom(e.l2_1),this.yz.scaleInPlace(.858086).scaleInPlace(-1),this.zx.copyFrom(e.l21),this.zx.scaleInPlace(.858086).scaleInPlace(-1),this.xy.copyFrom(e.l2_2),this.xy.scaleInPlace(.858086),this.scaleInPlace(1/Math.PI),this}static FromHarmonics(e){return(new h).updateFromHarmonics(e)}static FromArray(e){const a=new h;return l.Pq.FromArrayToRef(e[0],0,a.x),l.Pq.FromArrayToRef(e[1],0,a.y),l.Pq.FromArrayToRef(e[2],0,a.z),l.Pq.FromArrayToRef(e[3],0,a.xx),l.Pq.FromArrayToRef(e[4],0,a.yy),l.Pq.FromArrayToRef(e[5],0,a.zz),l.Pq.FromArrayToRef(e[6],0,a.yz),l.Pq.FromArrayToRef(e[7],0,a.zx),l.Pq.FromArrayToRef(e[8],0,a.xy),a}}},8894:(e,a,t)=>{t.d(a,{d:()=>i});var l=t(520),r=t(847),s=t(9026),o=t(1058),c=t(2544);class n{constructor(e,a,t,l){this.name=e,this.worldAxisForNormal=a,this.worldAxisForFileX=t,this.worldAxisForFileY=l}}class i{static ConvertCubeMapTextureToSphericalPolynomial(e){if(!e.isCube)return null;e.getScene()?.getEngine().flushFramebuffer();const a=e.getSize().width,t=e.readPixels(0,void 0,void 0,!1),l=e.readPixels(1,void 0,void 0,!1);let r,s;e.isRenderTarget?(r=e.readPixels(3,void 0,void 0,!1),s=e.readPixels(2,void 0,void 0,!1)):(r=e.readPixels(2,void 0,void 0,!1),s=e.readPixels(3,void 0,void 0,!1));const o=e.readPixels(4,void 0,void 0,!1),c=e.readPixels(5,void 0,void 0,!1),n=e.gammaSpace;let i=0;return 1!=e.textureType&&2!=e.textureType||(i=1),new Promise((e=>{Promise.all([l,t,r,s,o,c]).then((([t,l,r,s,o,c])=>{const h={size:a,right:l,left:t,up:r,down:s,front:o,back:c,format:5,type:i,gammaSpace:n};e(this.ConvertCubeMapToSphericalPolynomial(h))}))}))}static _AreaElement(e,a){return Math.atan2(e*a,Math.sqrt(e*e+a*a+1))}static ConvertCubeMapToSphericalPolynomial(e){const a=new s.O;let t=0;const l=2/e.size,n=l,i=.5*l,h=i-1;for(let s=0;s<6;s++){const P=this._FileFaces[s],d=e[P.name];let m=h;const u=5===e.format?4:3;for(let s=0;s<e.size;s++){let I=h;for(let n=0;n<e.size;n++){const h=P.worldAxisForFileX.scale(I).add(P.worldAxisForFileY.scale(m)).add(P.worldAxisForNormal);h.normalize();const A=this._AreaElement(I-i,m-i)-this._AreaElement(I-i,m+i)-this._AreaElement(I+i,m-i)+this._AreaElement(I+i,m+i);let p=d[s*e.size*u+n*u+0],f=d[s*e.size*u+n*u+1],y=d[s*e.size*u+n*u+2];isNaN(p)&&(p=0),isNaN(f)&&(f=0),isNaN(y)&&(y=0),0===e.type&&(p/=255,f/=255,y/=255),e.gammaSpace&&(p=Math.pow(r.X.Clamp(p),o.tk),f=Math.pow(r.X.Clamp(f),o.tk),y=Math.pow(r.X.Clamp(y),o.tk));const x=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const e=Math.max(p,f,y);if(e>x){const a=x/e;p*=a,f*=a,y*=a}}else p=r.X.Clamp(p,0,x),f=r.X.Clamp(f,0,x),y=r.X.Clamp(y,0,x);const F=new c.v9(p,f,y);a.addLight(h,F,A),t+=A,I+=l}m+=n}}const P=4*Math.PI*6/6/t;return a.scaleInPlace(P),a.convertIncidentRadianceToIrradiance(),a.convertIrradianceToLambertianRadiance(),s.Q.FromHarmonics(a)}}i._FileFaces=[new n("right",new l.Pq(1,0,0),new l.Pq(0,0,-1),new l.Pq(0,-1,0)),new n("left",new l.Pq(-1,0,0),new l.Pq(0,0,1),new l.Pq(0,-1,0)),new n("up",new l.Pq(0,1,0),new l.Pq(1,0,0),new l.Pq(0,0,1)),new n("down",new l.Pq(0,-1,0),new l.Pq(1,0,0),new l.Pq(0,0,-1)),new n("front",new l.Pq(0,0,1),new l.Pq(1,0,0),new l.Pq(0,-1,0)),new n("back",new l.Pq(0,0,-1),new l.Pq(-1,0,0),new l.Pq(0,-1,0))],i.MAX_HDRI_VALUE=4096,i.PRESERVE_CLAMPED_COLORS=!1},4935:(e,a,t)=>{t.d(a,{Qs:()=>i,SX:()=>m,LZ:()=>d}),t(8422),t(4571);var l=t(6792),r=t(3924),s=t(4677),o=t(9114);class c extends l.w{getClassName(){return"PassPostProcess"}constructor(e,a,t=null,l,r,s,o=0,c=!1){super(e,"pass",null,null,a,t,l,r,s,void 0,o,void 0,null,c)}_gatherImports(e,a){e?(this._webGPUReady=!0,a.push(Promise.all([t.e(702).then(t.bind(t,702))]))):a.push(Promise.all([Promise.resolve().then(t.bind(t,2307))])),super._gatherImports(e,a)}static _Parse(e,a,t,l){return o.p.Parse((()=>new c(e.name,e.options,a,e.renderTargetSamplingMode,e._engine,e.reusable)),e,t,l)}}(0,s.Y5)("BABYLON.PassPostProcess",c),l.w,r.$._RescalePostProcessFactory=e=>new c("rescale",1,null,2,e,!1,0);var n=t(6733);n.l.ShadersStore.lodPixelShader="#extension GL_EXT_shader_texture_lod : enable\nprecision highp float;const float GammaEncodePowerApprox=1.0/2.2;varying vec2 vUV;uniform sampler2D textureSampler;uniform float lod;uniform vec2 texSize;uniform bool gamma;void main(void)\n{gl_FragColor=textureLod(textureSampler,vUV,lod);if (!gamma) {gl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(GammaEncodePowerApprox));}}\n";function i(e,a,t,r,s,o,c,n){const i=a.getEngine();return a.isReady=!1,s=s??a.samplingMode,r=r??a.type,o=o??a.format,c=c??a.width,n=n??a.height,-1===r&&(r=0),new Promise((h=>{const P=new l.w("postprocess",e,null,null,1,null,s,i,!1,void 0,r,void 0,null,!1,o);P.externalTextureSamplerBinding=!0;const d=i.createRenderTargetTexture({width:c,height:n},{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:s,type:r,format:o});P.onEffectCreatedObservable.addOnce((e=>{e.executeWhenCompiled((()=>{P.onApply=e=>{e._bindTexture("textureSampler",a),e.setFloat2("scale",1,1)},t.postProcessManager.directRender([P],d,!0),i.restoreDefaultFramebuffer(),i._releaseTexture(a),P&&P.dispose(),d._swapAndDie(a),a.type=r,a.format=5,a.isReady=!0,h(a)}))}))}))}let h,P;function d(e){h||(h=new Float32Array(1),P=new Int32Array(h.buffer)),h[0]=e;const a=P[0];let t=a>>16&32768,l=a>>12&2047;const r=a>>23&255;return r<103?t:r>142?(t|=31744,t|=(255==r?0:1)&&8388607&a,t):r<113?(l|=2048,t|=(l>>114-r)+(l>>113-r&1),t):(t|=r-112<<10|l>>1,t+=1&l,t)}function m(e){const a=(32768&e)>>15,t=(31744&e)>>10,l=1023&e;return 0===t?(a?-1:1)*Math.pow(2,-14)*(l/Math.pow(2,10)):31==t?l?NaN:1/0*(a?-1:1):(a?-1:1)*Math.pow(2,t-15)*(1+l/Math.pow(2,10))}n.l.ShadersStore.lodCubePixelShader="precision highp float;const float GammaEncodePowerApprox=1.0/2.2;varying vec2 vUV;uniform samplerCube textureSampler;uniform float lod;uniform bool gamma;void main(void)\n{vec2 uv=vUV*2.0-1.0;\n#ifdef POSITIVEX\ngl_FragColor=textureCube(textureSampler,vec3(1.001,uv.y,uv.x),lod);\n#endif\n#ifdef NEGATIVEX\ngl_FragColor=textureCube(textureSampler,vec3(-1.001,uv.y,uv.x),lod);\n#endif\n#ifdef POSITIVEY\ngl_FragColor=textureCube(textureSampler,vec3(uv.y,1.001,uv.x),lod);\n#endif\n#ifdef NEGATIVEY\ngl_FragColor=textureCube(textureSampler,vec3(uv.y,-1.001,uv.x),lod);\n#endif\n#ifdef POSITIVEZ\ngl_FragColor=textureCube(textureSampler,vec3(uv,1.001),lod);\n#endif\n#ifdef NEGATIVEZ\ngl_FragColor=textureCube(textureSampler,vec3(uv,-1.001),lod);\n#endif\nif (!gamma) {gl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(GammaEncodePowerApprox));}}\n"}}]);