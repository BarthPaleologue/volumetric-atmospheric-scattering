"use strict";(self.webpackChunkvolumetric_atmospheric_scattering=self.webpackChunkvolumetric_atmospheric_scattering||[]).push([[21],{7768:(e,t,r)=>{var a=r(6293),n=r(7530),o=r(2928),s=r(9415),i=r(3924),l=r(9169);i.$.prototype._partialLoadFile=function(e,t,r,a,n=null){this._loadFile(e,(e=>{r[t]=e,r._internalCount++,6===r._internalCount&&a(r)}),void 0,void 0,!0,((e,t)=>{n&&e&&n(e.status+" "+e.statusText,t)}))},i.$.prototype._cascadeLoadFiles=function(e,t,r,a=null){const n=[];n._internalCount=0;for(let e=0;e<6;e++)this._partialLoadFile(r[e],e,n,t,a)},i.$.prototype._cascadeLoadImgs=function(e,t,r,a,n=null,o){const s=[];s._internalCount=0;for(let i=0;i<6;i++)this._partialLoadImg(a[i],i,s,e,t,r,n,o)},i.$.prototype._partialLoadImg=function(e,t,r,a,n,i,l=null,u){const f=(0,s.z)();(0,o.W$)(e,(e=>{r[t]=e,r._internalCount++,a&&a.removePendingData(f),6===r._internalCount&&i&&i(n,r)}),((e,t)=>{a&&a.removePendingData(f),l&&l(e,t)}),a?a.offlineProvider:null,u),a&&a.addPendingData(f)},i.$.prototype.createCubeTextureBase=function(e,t,r,o,s=null,i=null,u,f=null,_=!1,c=0,p=0,h=null,d=null,A=null,C=!1,E=null){const T=h||new a.h(this,7);T.isCube=!0,T.url=e,T.generateMipMaps=!o,T._lodGenerationScale=c,T._lodGenerationOffset=p,T._useSRGBBuffer=!!C&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!o),T!==h&&(T.label=e.substring(0,60)),this._doNotHandleContextLost||(T._extension=f,T._files=r,T._buffer=E);const m=e;this._transformTextureUrl&&!h&&(e=this._transformTextureUrl(e));const y=e.split("?")[0],B=y.lastIndexOf("."),b=f||(B>-1?y.substring(B).toLowerCase():""),g=(0,l.g)(b),G=(a,l)=>{e===m?i&&a&&i(a.status+" "+a.statusText,l):(n.V.Warn(`Failed to load ${e}, falling back to the ${m}`),this.createCubeTextureBase(m,t,r,!!o,s,i,u,f,_,c,p,T,d,A,C,E))};if(g)g.then((a=>{const o=e=>{d&&d(T,e),a.loadCubeData(e,T,_,s,i)};E?o(E):r&&6===r.length?a.supportCascades?this._cascadeLoadFiles(t,(e=>o(e.map((e=>new Uint8Array(e))))),r,i):i?i("Textures type does not support cascades."):n.V.Warn("Texture loader does not support cascades."):this._loadFile(e,(e=>o(new Uint8Array(e))),void 0,void 0,!0,G)}));else{if(!r||0===r.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(t,T,((e,t)=>{A&&A(e,t)}),r,i)}return this._internalTexturesCache.push(T),T}},5312:(e,t,r)=>{var a=r(9229),n=r(6293),o=r(7530),s=r(2228);a.w.prototype._createDepthStencilCubeTexture=function(e,t){const r=new n.h(this,12);if(r.isCube=!0,1===this.webGLVersion)return o.V.Error("Depth cube texture is not supported by WebGL 1."),r;const a={bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1,...t},s=this._gl;this._bindTextureDirectly(s.TEXTURE_CUBE_MAP,r,!0),this._setupDepthStencilTexture(r,e,a.generateStencil,a.bilinearFiltering,a.comparisonFunction);for(let t=0;t<6;t++)a.generateStencil?s.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,s.DEPTH24_STENCIL8,e,e,0,s.DEPTH_STENCIL,s.UNSIGNED_INT_24_8,null):s.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,s.DEPTH_COMPONENT24,e,e,0,s.DEPTH_COMPONENT,s.UNSIGNED_INT,null);return this._bindTextureDirectly(s.TEXTURE_CUBE_MAP,null),this._internalTexturesCache.push(r),r},a.w.prototype._setCubeMapTextureParams=function(e,t,r){const a=this._gl;a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_MIN_FILTER,t?a.LINEAR_MIPMAP_LINEAR:a.LINEAR),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),e.samplingMode=t?3:2,t&&this.getCaps().textureMaxLevel&&void 0!==r&&r>0&&(a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_MAX_LEVEL,r),e._maxLodLevel=r),this._bindTextureDirectly(a.TEXTURE_CUBE_MAP,null)},a.w.prototype.createCubeTexture=function(e,t,r,a,n=null,i=null,l,u=null,f=!1,_=0,c=0,p=null,h,d=!1,A=null){const C=this._gl;return this.createCubeTextureBase(e,t,r,!!a,n,i,l,u,f,_,c,p,(e=>this._bindTextureDirectly(C.TEXTURE_CUBE_MAP,e,!0)),((e,t)=>{const r=this.needPOTTextures?(0,s.R)(t[0].width,this._caps.maxCubemapTextureSize):t[0].width,i=r,u=[C.TEXTURE_CUBE_MAP_POSITIVE_X,C.TEXTURE_CUBE_MAP_POSITIVE_Y,C.TEXTURE_CUBE_MAP_POSITIVE_Z,C.TEXTURE_CUBE_MAP_NEGATIVE_X,C.TEXTURE_CUBE_MAP_NEGATIVE_Y,C.TEXTURE_CUBE_MAP_NEGATIVE_Z];this._bindTextureDirectly(C.TEXTURE_CUBE_MAP,e,!0),this._unpackFlipY(!1);const f=l?this._getInternalFormat(l,e._useSRGBBuffer):e._useSRGBBuffer?this._glSRGBExtensionValues.SRGB8_ALPHA8:C.RGBA;let _=l?this._getInternalFormat(l):C.RGBA;e._useSRGBBuffer&&1===this.webGLVersion&&(_=f);for(let e=0;e<u.length;e++)if(t[e].width!==r||t[e].height!==i){if(this._prepareWorkingCanvas(),!this._workingCanvas||!this._workingContext)return void o.V.Warn("Cannot create canvas to resize texture.");this._workingCanvas.width=r,this._workingCanvas.height=i,this._workingContext.drawImage(t[e],0,0,t[e].width,t[e].height,0,0,r,i),C.texImage2D(u[e],0,f,_,C.UNSIGNED_BYTE,this._workingCanvas)}else C.texImage2D(u[e],0,f,_,C.UNSIGNED_BYTE,t[e]);a||C.generateMipmap(C.TEXTURE_CUBE_MAP),this._setCubeMapTextureParams(e,!a),e.width=r,e.height=i,e.isReady=!0,l&&(e.format=l),e.onLoadedObservable.notifyObservers(e),e.onLoadedObservable.clear(),n&&n()}),!!d,A)},a.w.prototype.generateMipMapsForCubemap=function(e,t=!0){if(e.generateMipMaps){const r=this._gl;this._bindTextureDirectly(r.TEXTURE_CUBE_MAP,e,!0),r.generateMipmap(r.TEXTURE_CUBE_MAP),t&&this._bindTextureDirectly(r.TEXTURE_CUBE_MAP,null)}}},8021:(e,t,r)=>{r.r(t),r.d(t,{_DDSTextureLoader:()=>o});var a=r(9026),n=r(1817);r(5312);class o{constructor(){this.supportCascades=!0}loadCubeData(e,t,r,o){const s=t.getEngine();let i,l=!1,u=1e3;if(Array.isArray(e))for(let r=0;r<e.length;r++){const a=e[r];i=n.D.GetDDSInfo(a),t.width=i.width,t.height=i.height,l=(i.isRGB||i.isLuminance||i.mipmapCount>1)&&t.generateMipMaps,s._unpackFlipY(i.isCompressed),n.D.UploadDDSLevels(s,t,a,i,l,6,-1,r),i.isFourCC||1!==i.mipmapCount?u=i.mipmapCount-1:s.generateMipMapsForCubemap(t)}else{const o=e;i=n.D.GetDDSInfo(o),t.width=i.width,t.height=i.height,r&&(i.sphericalPolynomial=new a.Q),l=(i.isRGB||i.isLuminance||i.mipmapCount>1)&&t.generateMipMaps,s._unpackFlipY(i.isCompressed),n.D.UploadDDSLevels(s,t,o,i,l,6),i.isFourCC||1!==i.mipmapCount?u=i.mipmapCount-1:s.generateMipMapsForCubemap(t,!1)}s._setCubeMapTextureParams(t,l,u),t.isReady=!0,t.onLoadedObservable.notifyObservers(t),t.onLoadedObservable.clear(),o&&o({isDDS:!0,width:t.width,info:i,data:e,texture:t})}loadData(e,t,r){const a=n.D.GetDDSInfo(e),o=(a.isRGB||a.isLuminance||a.mipmapCount>1)&&t.generateMipMaps&&Math.max(a.width,a.height)>>a.mipmapCount-1==1;r(a.width,a.height,o,a.isFourCC,(()=>{n.D.UploadDDSLevels(t.getEngine(),t,e,a,o,1)}))}}},1817:(e,t,r)=>{r.d(t,{D:()=>h});var a=r(847),n=r(7530),o=r(8894),s=r(4935);r(7768),r(5312);const i=131072,l=131072;function u(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}const f=u("DXT1"),_=u("DXT3"),c=u("DXT5"),p=u("DX10");class h{static GetDDSInfo(e){const t=new Int32Array(e.buffer,e.byteOffset,31),r=new Int32Array(e.buffer,e.byteOffset,35);let a=1;t[2]&i&&(a=Math.max(1,t[7]));const n=t[21],o=n===p?r[32]:0;let s=0;switch(n){case 113:s=2;break;case 116:s=1;break;case p:if(10===o){s=2;break}if(2===o){s=1;break}}return{width:t[4],height:t[3],mipmapCount:a,isFourCC:!(4&~t[20]),isRGB:!(64&~t[20]),isLuminance:(t[20]&l)===l,isCube:!(512&~t[28]),isCompressed:n===f||n===_||n===c,dxgiFormat:o,textureType:s}}static _GetHalfFloatAsFloatRGBAArrayBuffer(e,t,r,a,n,o){const i=new Float32Array(a),l=new Uint16Array(n,r);let u=0;for(let r=0;r<t;r++)for(let t=0;t<e;t++){const a=4*(t+r*e);i[u]=(0,s.SX)(l[a]),i[u+1]=(0,s.SX)(l[a+1]),i[u+2]=(0,s.SX)(l[a+2]),h.StoreLODInAlphaChannel?i[u+3]=o:i[u+3]=(0,s.SX)(l[a+3]),u+=4}return i}static _GetHalfFloatRGBAArrayBuffer(e,t,r,a,n,o){if(h.StoreLODInAlphaChannel){const i=new Uint16Array(a),l=new Uint16Array(n,r);let u=0;for(let r=0;r<t;r++)for(let t=0;t<e;t++){const a=4*(t+r*e);i[u]=l[a],i[u+1]=l[a+1],i[u+2]=l[a+2],i[u+3]=(0,s.LZ)(o),u+=4}return i}return new Uint16Array(n,r,a)}static _GetFloatRGBAArrayBuffer(e,t,r,a,n,o){if(h.StoreLODInAlphaChannel){const s=new Float32Array(a),i=new Float32Array(n,r);let l=0;for(let r=0;r<t;r++)for(let t=0;t<e;t++){const a=4*(t+r*e);s[l]=i[a],s[l+1]=i[a+1],s[l+2]=i[a+2],s[l+3]=o,l+=4}return s}return new Float32Array(n,r,a)}static _GetFloatAsHalfFloatRGBAArrayBuffer(e,t,r,a,n,o){const i=new Uint16Array(a),l=new Float32Array(n,r);let u=0;for(let r=0;r<t;r++)for(let t=0;t<e;t++)i[u]=(0,s.LZ)(l[u]),i[u+1]=(0,s.LZ)(l[u+1]),i[u+2]=(0,s.LZ)(l[u+2]),h.StoreLODInAlphaChannel?i[u+3]=(0,s.LZ)(o):i[u+3]=(0,s.LZ)(l[u+3]),u+=4;return i}static _GetFloatAsUIntRGBAArrayBuffer(e,t,r,n,o,s){const i=new Uint8Array(n),l=new Float32Array(o,r);let u=0;for(let r=0;r<t;r++)for(let t=0;t<e;t++){const n=4*(t+r*e);i[u]=255*a.X.Clamp(l[n]),i[u+1]=255*a.X.Clamp(l[n+1]),i[u+2]=255*a.X.Clamp(l[n+2]),h.StoreLODInAlphaChannel?i[u+3]=s:i[u+3]=255*a.X.Clamp(l[n+3]),u+=4}return i}static _GetHalfFloatAsUIntRGBAArrayBuffer(e,t,r,n,o,i){const l=new Uint8Array(n),u=new Uint16Array(o,r);let f=0;for(let r=0;r<t;r++)for(let t=0;t<e;t++){const n=4*(t+r*e);l[f]=255*a.X.Clamp((0,s.SX)(u[n])),l[f+1]=255*a.X.Clamp((0,s.SX)(u[n+1])),l[f+2]=255*a.X.Clamp((0,s.SX)(u[n+2])),h.StoreLODInAlphaChannel?l[f+3]=i:l[f+3]=255*a.X.Clamp((0,s.SX)(u[n+3])),f+=4}return l}static _GetRGBAArrayBuffer(e,t,r,a,n,o,s,i,l){const u=new Uint8Array(a),f=new Uint8Array(n,r);let _=0;for(let r=0;r<t;r++)for(let t=0;t<e;t++){const a=4*(t+r*e);u[_]=f[a+o],u[_+1]=f[a+s],u[_+2]=f[a+i],u[_+3]=f[a+l],_+=4}return u}static _ExtractLongWordOrder(e){return 0===e||255===e||-16777216===e?0:1+h._ExtractLongWordOrder(e>>8)}static _GetRGBArrayBuffer(e,t,r,a,n,o,s,i){const l=new Uint8Array(a),u=new Uint8Array(n,r);let f=0;for(let r=0;r<t;r++)for(let t=0;t<e;t++){const a=3*(t+r*e);l[f]=u[a+o],l[f+1]=u[a+s],l[f+2]=u[a+i],f+=3}return l}static _GetLuminanceArrayBuffer(e,t,r,a,n){const o=new Uint8Array(a),s=new Uint8Array(n,r);let i=0;for(let r=0;r<t;r++)for(let t=0;t<e;t++){const a=t+r*e;o[i]=s[a],i++}return o}static UploadDDSLevels(e,t,r,a,s,l,u=-1,d,A=!0){let C=null;a.sphericalPolynomial&&(C=[]);const E=!!e.getCaps().s3tc;t.generateMipMaps=s;const T=new Int32Array(r.buffer,r.byteOffset,31);let m,y,B,b,g,G,U,D=0,R=0,x=1;if(542327876!==T[0])return void n.V.Error("Invalid magic number in DDS header");if(!a.isFourCC&&!a.isRGB&&!a.isLuminance)return void n.V.Error("Unsupported format, must contain a FourCC, RGB or LUMINANCE code");if(a.isCompressed&&!E)return void n.V.Error("Compressed textures are not supported on this platform.");let F=T[22];b=T[1]+4;let w=!1;if(a.isFourCC)switch(m=T[21],m){case f:x=8,R=33777;break;case _:x=16,R=33778;break;case c:x=16,R=33779;break;case 113:w=!0,F=64;break;case 116:w=!0,F=128;break;case p:{b+=20;let e=!1;switch(a.dxgiFormat){case 10:w=!0,F=64,e=!0;break;case 2:w=!0,F=128,e=!0;break;case 88:a.isRGB=!0,a.isFourCC=!1,F=32,e=!0}if(e)break}default:return void n.V.Error(["Unsupported FourCC code:",(L=m,String.fromCharCode(255&L,L>>8&255,L>>16&255,L>>24&255))])}var L;const M=h._ExtractLongWordOrder(T[23]),I=h._ExtractLongWordOrder(T[24]),P=h._ExtractLongWordOrder(T[25]),S=h._ExtractLongWordOrder(T[26]);w&&(R=e._getRGBABufferInternalSizedFormat(a.textureType)),G=1,T[2]&i&&!1!==s&&(G=Math.max(1,T[7]));const X=d||0,O=e.getCaps();for(let n=X;n<l;n++){for(y=T[4],B=T[3],U=0;U<G;++U){if(-1===u||u===U){const o=-1===u?U:0;if(!a.isCompressed&&a.isFourCC){t.format=5,D=y*B*4;let a=null;if(e._badOS||e._badDesktopOS||!O.textureHalfFloat&&!O.textureFloat)128===F?(a=h._GetFloatAsUIntRGBAArrayBuffer(y,B,r.byteOffset+b,D,r.buffer,o),C&&0==o&&C.push(h._GetFloatRGBAArrayBuffer(y,B,r.byteOffset+b,D,r.buffer,o))):64===F&&(a=h._GetHalfFloatAsUIntRGBAArrayBuffer(y,B,r.byteOffset+b,D,r.buffer,o),C&&0==o&&C.push(h._GetHalfFloatAsFloatRGBAArrayBuffer(y,B,r.byteOffset+b,D,r.buffer,o))),t.type=0;else{const e=O.textureFloat&&(A&&O.textureFloatLinearFiltering||!A),n=O.textureHalfFloat&&(A&&O.textureHalfFloatLinearFiltering||!A),s=(128===F||64===F&&!n)&&e?1:(64===F||128===F&&!e)&&n?2:0;let i,l=null;if(128===F)switch(s){case 1:i=h._GetFloatRGBAArrayBuffer,l=null;break;case 2:i=h._GetFloatAsHalfFloatRGBAArrayBuffer,l=h._GetFloatRGBAArrayBuffer;break;case 0:i=h._GetFloatAsUIntRGBAArrayBuffer,l=h._GetFloatRGBAArrayBuffer}else switch(s){case 1:i=h._GetHalfFloatAsFloatRGBAArrayBuffer,l=null;break;case 2:i=h._GetHalfFloatRGBAArrayBuffer,l=h._GetHalfFloatAsFloatRGBAArrayBuffer;break;case 0:i=h._GetHalfFloatAsUIntRGBAArrayBuffer,l=h._GetHalfFloatAsFloatRGBAArrayBuffer}t.type=s,a=i(y,B,r.byteOffset+b,D,r.buffer,o),C&&0==o&&C.push(l?l(y,B,r.byteOffset+b,D,r.buffer,o):a)}a&&e._uploadDataToTextureDirectly(t,a,n,o)}else if(a.isRGB)t.type=0,24===F?(t.format=4,D=y*B*3,g=h._GetRGBArrayBuffer(y,B,r.byteOffset+b,D,r.buffer,M,I,P),e._uploadDataToTextureDirectly(t,g,n,o)):(t.format=5,D=y*B*4,g=h._GetRGBAArrayBuffer(y,B,r.byteOffset+b,D,r.buffer,M,I,P,S),e._uploadDataToTextureDirectly(t,g,n,o));else if(a.isLuminance){const a=e._getUnpackAlignement(),s=y;D=Math.floor((y+a-1)/a)*a*(B-1)+s,g=h._GetLuminanceArrayBuffer(y,B,r.byteOffset+b,D,r.buffer),t.format=1,t.type=0,e._uploadDataToTextureDirectly(t,g,n,o)}else D=Math.max(4,y)/4*Math.max(4,B)/4*x,g=new Uint8Array(r.buffer,r.byteOffset+b,D),t.type=0,e._uploadCompressedDataToTextureDirectly(t,R,y,B,g,n,o)}b+=F?y*B*(F/8):D,y*=.5,B*=.5,y=Math.max(1,y),B=Math.max(1,B)}if(void 0!==d)break}C&&C.length>0?a.sphericalPolynomial=o.d.ConvertCubeMapToSphericalPolynomial({size:T[4],right:C[0],left:C[1],up:C[2],down:C[3],front:C[4],back:C[5],format:5,type:1,gammaSpace:!1}):a.sphericalPolynomial=void 0}}h.StoreLODInAlphaChannel=!1}}]);