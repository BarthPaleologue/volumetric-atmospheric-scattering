"use strict";(self.webpackChunkvolumetric_atmospheric_scattering=self.webpackChunkvolumetric_atmospheric_scattering||[]).push([[887],{9887:(e,t,n)=>{n.r(t),n.d(t,{_ExrTextureLoader:()=>H});var r=n(8423),o=n(7233);const a=65536,i=14,l=65537;var c,s;!function(e){e[e.NO_COMPRESSION=0]="NO_COMPRESSION",e[e.RLE_COMPRESSION=1]="RLE_COMPRESSION",e[e.ZIPS_COMPRESSION=2]="ZIPS_COMPRESSION",e[e.ZIP_COMPRESSION=3]="ZIP_COMPRESSION",e[e.PIZ_COMPRESSION=4]="PIZ_COMPRESSION",e[e.PXR24_COMPRESSION=5]="PXR24_COMPRESSION"}(c||(c={})),function(e){e[e.INCREASING_Y=0]="INCREASING_Y",e[e.DECREASING_Y=1]="DECREASING_Y"}(s||(s={}));const u=function(){const e=new ArrayBuffer(4),t=new Float32Array(e),n=new Uint32Array(e),r=new Uint32Array(512),o=new Uint32Array(512);for(let e=0;e<256;++e){const t=e-127;t<-27?(r[e]=0,r[256|e]=32768,o[e]=24,o[256|e]=24):t<-14?(r[e]=1024>>-t-14,r[256|e]=1024>>-t-14|32768,o[e]=-t-1,o[256|e]=-t-1):t<=15?(r[e]=t+15<<10,r[256|e]=t+15<<10|32768,o[e]=13,o[256|e]=13):t<128?(r[e]=31744,r[256|e]=64512,o[e]=24,o[256|e]=24):(r[e]=31744,r[256|e]=64512,o[e]=13,o[256|e]=13)}const a=new Uint32Array(2048),i=new Uint32Array(64),l=new Uint32Array(64);for(let e=1;e<1024;++e){let t=e<<13,n=0;for(;!(8388608&t);)t<<=1,n-=8388608;t&=-8388609,n+=947912704,a[e]=t|n}for(let e=1024;e<2048;++e)a[e]=939524096+(e-1024<<13);for(let e=1;e<31;++e)i[e]=e<<23;i[31]=1199570944,i[32]=2147483648;for(let e=33;e<63;++e)i[e]=2147483648+(e-32<<23);i[63]=3347054592;for(let e=1;e<64;++e)32!==e&&(l[e]=1024);return{floatView:t,uint32View:n,baseTable:r,shiftTable:o,mantissaTable:a,exponentTable:i,offsetTable:l}}();function f(e,t){const n=new Uint8Array(e);let r=0;for(;0!=n[t.value+r];)r+=1;const o=(new TextDecoder).decode(n.slice(t.value,t.value+r));return t.value=t.value+r+1,o}function w(e,t){const n=e.getInt32(t.value,!0);return t.value+=4,n}function h(e,t){const n=e.getUint32(t.value,!0);return t.value+=4,n}function p(e,t){const n=e.getUint8(t.value);return t.value+=1,n}function y(e,t){const n=e.getUint16(t.value,!0);return t.value+=2,n}function d(e,t){const n=e[t.value];return t.value+=1,n}function v(e,t){let n;return n="getBigInt64"in DataView.prototype?Number(e.getBigInt64(t.value,!0)):e.getUint32(t.value+4,!0)+Number(e.getUint32(t.value,!0)<<32),t.value+=8,n}function b(e,t){const n=e.getFloat32(t.value,!0);return t.value+=4,n}function S(e,t){return function(e){const t=(31744&e)>>10,n=1023&e;return(e>>15?-1:1)*(t?31===t?n?NaN:1/0:Math.pow(2,t-15)*(1+n/1024):n/1024*6103515625e-14)}(y(e,t))}function E(e,t){return function(e){if(Math.abs(e)>65504)throw new Error("Value out of range.Consider using float instead of half-float.");e=(0,o.OQ)(e,-65504,65504),u.floatView[0]=e;const t=u.uint32View[0],n=t>>23&511;return u.baseTable[n]+((8388607&t)>>u.shiftTable[n])}(b(e,t))}function g(e,t,n,r){switch(n){case"string":case"stringvector":case"iccProfile":return function(e,t,n){const r=(new TextDecoder).decode(new Uint8Array(e).slice(t.value,t.value+n));return t.value=t.value+n,r}(e.buffer,t,r);case"chlist":return function(e,t,n){const r=t.value,o=[];for(;t.value<r+n-1;){const n=f(e.buffer,t),r=w(e,t),a=p(e,t);t.value+=3;const i=w(e,t),l=w(e,t);o.push({name:n,pixelType:r,pLinear:a,xSampling:i,ySampling:l})}return t.value+=1,o}(e,t,r);case"chromaticities":return function(e,t){return{redX:b(e,t),redY:b(e,t),greenX:b(e,t),greenY:b(e,t),blueX:b(e,t),blueY:b(e,t),whiteX:b(e,t),whiteY:b(e,t)}}(e,t);case"compression":return function(e,t){return p(e,t)}(e,t);case"box2i":return function(e,t){return{xMin:w(e,t),yMin:w(e,t),xMax:w(e,t),yMax:w(e,t)}}(e,t);case"lineOrder":return function(e,t){const n=p(e,t);return s[n]}(e,t);case"float":return b(e,t);case"v2f":return function(e,t){return[b(e,t),b(e,t)]}(e,t);case"v3f":return function(e,t){return[b(e,t),b(e,t),b(e,t)]}(e,t);case"int":return w(e,t);case"rational":return function(e,t){return[w(e,t),h(e,t)]}(e,t);case"timecode":return function(e,t){return[h(e,t),h(e,t)]}(e,t);case"preview":return t.value+=r,"skipped";default:return void(t.value+=r)}}function A(e){for(let t=1;t<e.length;t++){const n=e[t-1]+e[t]-128;e[t]=n}}function O(e,t){let n=0,r=Math.floor((e.length+1)/2),o=0;const a=e.length-1;for(;!(o>a||(t[o++]=e[n++],o>a));)t[o++]=e[r++]}function I(e,t,n,r,o){for(;n<e;)t=t<<8|d(r,o),n+=8;return{l:t>>(n-=e)&(1<<e)-1,c:t,lc:n}}function C(e,t,n,r){return{c:e=e<<8|d(n,r),lc:t+=8}}function m(e,t,n,r,o,a,i,l,c){if(e==t){if(r<8){const e=C(n,r,o,a);n=e.c,r=e.lc}let e=n>>(r-=8);if(e=new Uint8Array([e])[0],l.value+e>c)return null;const t=i[l.value-1];for(;e-- >0;)i[l.value++]=t}else{if(!(l.value<c))return null;i[l.value++]=e}return{c:n,lc:r}}const U=new Array(59);function M(e){return 63&e}function P(e){return e>>6}function N(e,t,n,r,o,a){const c=n.value,s=h(t,n),u=h(t,n);n.value+=4;const f=h(t,n);if(n.value+=4,s<0||s>=l||u<0||u>=l)throw new Error("Wrong HUF_ENCSIZE");const w=new Array(l),p=new Array(16384);if(function(e){for(let t=0;t<16384;t++)e[t]={},e[t].len=0,e[t].lit=0,e[t].p=null}(p),function(e,t,n,r,o,a){const i=t;let c=0,s=0;for(;r<=o;r++){if(i.value-t.value>n)return;let l=I(6,c,s,e,i);const u=l.l;if(c=l.c,s=l.lc,a[r]=u,63==u){if(i.value-t.value>n)throw new Error("Error in HufUnpackEncTable");l=I(8,c,s,e,i);let u=l.l+6;if(c=l.c,s=l.lc,r+u>o+1)throw new Error("Error in HufUnpackEncTable");for(;u--;)a[r++]=0;r--}else if(u>=59){let e=u-59+2;if(r+e>o+1)throw new Error("Error in HufUnpackEncTable");for(;e--;)a[r++]=0;r--}}!function(e){for(let e=0;e<=58;++e)U[e]=0;for(let t=0;t<l;++t)U[e[t]]+=1;let t=0;for(let e=58;e>0;--e){const n=t+U[e]>>1;U[e]=t,t=n}for(let t=0;t<l;++t){const n=e[t];n>0&&(e[t]=n|U[n]++<<6)}}(a)}(e,n,r-(n.value-c),s,u,w),f>8*(r-(n.value-c)))throw new Error("Wrong hufUncompress");!function(e,t,n,r){for(;t<=n;t++){const n=P(e[t]),o=M(e[t]);if(n>>o)throw new Error("Invalid table entry");if(o>i){const e=r[n>>o-i];if(e.len)throw new Error("Invalid table entry");if(e.lit++,e.p){const t=e.p;e.p=new Array(e.lit);for(let n=0;n<e.lit-1;++n)e.p[n]=t[n]}else e.p=new Array(1);e.p[e.lit-1]=t}else if(o){let e=0;for(let a=1<<i-o;a>0;a--){const a=r[(n<<i-o)+e];if(a.len||a.p)throw new Error("Invalid table entry");a.len=o,a.lit=t,e++}}}}(w,s,u,p),function(e,t,n,r,o,a,l,c,s){let u=0,f=0;const w=l,h=Math.trunc(r.value+(o+7)/8);for(;r.value<h;){let o=C(u,f,n,r);for(u=o.c,f=o.lc;f>=i;){const l=t[u>>f-i&16383];if(l.len){f-=l.len;const e=m(l.lit,a,u,f,n,r,c,s,w);e&&(u=e.c,f=e.lc)}else{if(!l.p)throw new Error("hufDecode issues");let t;for(t=0;t<l.lit;t++){const i=M(e[l.p[t]]);for(;f<i&&r.value<h;)o=C(u,f,n,r),u=o.c,f=o.lc;if(f>=i&&P(e[l.p[t]])==(u>>f-i&(1<<i)-1)){f-=i;const e=m(l.p[t],a,u,f,n,r,c,s,w);e&&(u=e.c,f=e.lc);break}}if(t==l.lit)throw new Error("HufDecode issues")}}}const p=8-o&7;for(u>>=p,f-=p;f>0;){const e=t[u<<i-f&16383];if(!e.len)throw new Error("HufDecode issues");{f-=e.len;const t=m(e.lit,a,u,f,n,r,c,s,w);t&&(u=t.c,f=t.lc)}}}(w,p,e,n,f,u,a,o,{value:0})}function R(e){return 65535&e}function k(e){const t=R(e);return t>32767?t-65536:t}function x(e,t){const n=k(e),r=k(t),o=n+(1&r)+(r>>1);return{a:o,b:o-r}}function _(e,t){const n=R(e),r=R(t),o=n-(r>>1)&65535;return{a:r+o-32768&65535,b:o}}function T(e,t,n,r,o,a,i){const l=i<16384,c=n>o?o:n;let s,u,f=1;for(;f<=c;)f<<=1;for(f>>=1,s=f,f>>=1;f>=1;){u=0;const i=u+a*(o-s),c=a*f,w=a*s,h=r*f,p=r*s;let y,d,v,b;for(;u<=i;u+=w){let o=u;const a=u+r*(n-s);for(;o<=a;o+=p){const n=o+h,r=o+c,a=r+h;if(l){let i=x(e[o+t],e[r+t]);y=i.a,v=i.b,i=x(e[n+t],e[a+t]),d=i.a,b=i.b,i=x(y,d),e[o+t]=i.a,e[n+t]=i.b,i=x(v,b),e[r+t]=i.a,e[a+t]=i.b}else{let i=_(e[o+t],e[r+t]);y=i.a,v=i.b,i=_(e[n+t],e[a+t]),d=i.a,b=i.b,i=_(y,d),e[o+t]=i.a,e[n+t]=i.b,i=_(v,b),e[r+t]=i.a,e[a+t]=i.b}}if(n&f){const n=o+c;let r;r=l?x(e[o+t],e[n+t]):_(e[o+t],e[n+t]),y=r.a,e[n+t]=r.b,e[o+t]=y}}if(o&f){let o=u;const a=u+r*(n-s);for(;o<=a;o+=p){const n=o+h;let r;r=l?x(e[o+t],e[n+t]):_(e[o+t],e[n+t]),y=r.a,e[n+t]=r.b,e[o+t]=y}}s=f,f>>=1}return u}function z(e){return new DataView(e.array.buffer,e.offset.value,e.size)}function L(e){const t=e.viewer.buffer.slice(e.offset.value,e.offset.value+e.size),n=new Uint8Array(function(e){let t=e.byteLength;const n=new Array;let r=0;const o=new DataView(e);for(;t>0;){const e=o.getInt8(r++);if(e<0){const a=-e;t-=a+1;for(let e=0;e<a;e++)n.push(o.getUint8(r++))}else{const a=e;t-=2;const i=o.getUint8(r++);for(let e=0;e<a+1;e++)n.push(i)}}return n}(t)),r=new Uint8Array(n.length);return A(n),O(n,r),new DataView(r.buffer)}function F(e){const t=e.array.slice(e.offset.value,e.offset.value+e.size),n=fflate.unzlibSync(t),r=new Uint8Array(n.length);return A(n),O(n,r),new DataView(r.buffer)}function D(e){const t=e.array.slice(e.offset.value,e.offset.value+e.size),n=fflate.unzlibSync(t),r=e.lines*e.channels*e.width,o=1==e.type?new Uint16Array(r):new Uint32Array(r);let a=0,i=0;const l=new Array(4);for(let t=0;t<e.lines;t++)for(let t=0;t<e.channels;t++){let t=0;switch(e.type){case 1:l[0]=a,l[1]=l[0]+e.width,a=l[1]+e.width;for(let r=0;r<e.width;++r)t+=n[l[0]++]<<8|n[l[1]++],o[i]=t,i++;break;case 2:l[0]=a,l[1]=l[0]+e.width,l[2]=l[1]+e.width,a=l[2]+e.width;for(let r=0;r<e.width;++r)t+=n[l[0]++]<<24|n[l[1]++]<<16|n[l[2]++]<<8,o[i]=t,i++}}return new DataView(o.buffer)}function B(e){const t=e.viewer,n={value:e.offset.value},r=new Uint16Array(e.width*e.scanlineBlockSize*(e.channels*e.type)),o=new Uint8Array(8192);let i=0;const l=new Array(e.channels);for(let t=0;t<e.channels;t++)l[t]={},l[t].start=i,l[t].end=l[t].start,l[t].nx=e.width,l[t].ny=e.lines,l[t].size=e.type,i+=l[t].nx*l[t].ny*l[t].size;const c=y(t,n),s=y(t,n);if(s>=8192)throw new Error("Wrong PIZ_COMPRESSION BITMAP_SIZE");if(c<=s)for(let e=0;e<s-c+1;e++)o[e+c]=p(t,n);const u=new Uint16Array(a),f=function(e,t){let n=0;for(let r=0;r<a;++r)(0==r||e[r>>3]&1<<(7&r))&&(t[n++]=r);const r=n-1;for(;n<a;)t[n++]=0;return r}(o,u),w=h(t,n);N(e.array,t,n,w,r,i);for(let t=0;t<e.channels;++t){const e=l[t];for(let n=0;n<l[t].size;++n)T(r,e.start+n,e.nx,e.size,e.ny,e.nx*e.size,f)}!function(e,t,n){for(let r=0;r<n;++r)t[r]=e[t[r]]}(u,r,i);let d=0;const v=new Uint8Array(r.buffer.byteLength);for(let t=0;t<e.lines;t++)for(let t=0;t<e.channels;t++){const e=l[t],n=e.nx*e.size,o=new Uint8Array(r.buffer,2*e.end,2*n);v.set(o,d),d+=2*n,e.end+=n}return new DataView(v.buffer)}var W,V=n(3308);!function(e){e[e.Float=0]="Float",e[e.HalfFloat=1]="HalfFloat"}(W||(W={}));class Y{}Y.DefaultOutputType=W.HalfFloat,Y.FFLATEUrl="https://unpkg.com/fflate@0.8.2";class H{constructor(){this.supportCascades=!1}loadCubeData(e,t,n,r,o){throw".exr not supported in Cube."}async loadData(e,t,n){const o=new DataView(e.buffer),a={value:0},i=function(e,t){if(20000630!=e.getUint32(0,!0))throw new Error("Incorrect OpenEXR format");const n=e.getUint8(4),o=e.getUint8(5),a={singleTile:!!(2&o),longName:!!(4&o),deepFormat:!!(8&o),multiPart:!!(16&o)};t.value=8;const i={};let l=!0;for(;l;){const n=f(e.buffer,t);if(n){const o=f(e.buffer,t),a=g(e,t,o,h(e,t));void 0===a?r.V.Warn(`Unknown header attribute type ${o}'.`):i[n]=a}else l=!1}if(-5&o)throw new Error("Unsupported file format");return{version:n,spec:a,...i}}(o,a),l=await async function(e,t,n,r){const o={size:0,viewer:t,array:new Uint8Array(t.buffer),offset:n,width:e.dataWindow.xMax-e.dataWindow.xMin+1,height:e.dataWindow.yMax-e.dataWindow.yMin+1,channels:e.channels.length,channelLineOffsets:{},scanOrder:()=>0,bytesPerLine:0,outLineWidth:0,lines:0,scanlineBlockSize:0,inputSize:null,type:0,uncompress:null,getter:()=>0,format:5,outputChannels:0,decodeChannels:{},blockCount:null,byteArray:null,linearSpace:!1,textureType:0};switch(e.compression){case c.NO_COMPRESSION:o.lines=1,o.uncompress=z;break;case c.RLE_COMPRESSION:o.lines=1,o.uncompress=L;break;case c.ZIPS_COMPRESSION:o.lines=1,o.uncompress=F,await V.S0.LoadScriptAsync(Y.FFLATEUrl);break;case c.ZIP_COMPRESSION:o.lines=16,o.uncompress=F,await V.S0.LoadScriptAsync(Y.FFLATEUrl);break;case c.PIZ_COMPRESSION:o.lines=32,o.uncompress=B;break;case c.PXR24_COMPRESSION:o.lines=16,o.uncompress=D,await V.S0.LoadScriptAsync(Y.FFLATEUrl);break;default:throw new Error(c[e.compression]+" is unsupported")}o.scanlineBlockSize=o.lines;const a={};for(const t of e.channels)switch(t.name){case"Y":case"R":case"G":case"B":case"A":a[t.name]=!0,o.type=t.pixelType}let i=!1;if(a.R&&a.G&&a.B)i=!a.A,o.outputChannels=4,o.decodeChannels={R:0,G:1,B:2,A:3};else{if(!a.Y)throw new Error("EXRLoader.parse: file contains unsupported data channels.");o.outputChannels=1,o.decodeChannels={Y:0}}if(1===o.type)switch(r){case W.Float:o.getter=S,o.inputSize=2;break;case W.HalfFloat:o.getter=y,o.inputSize=2}else{if(2!==o.type)throw new Error("Unsupported pixelType "+o.type+" for "+e.compression);switch(r){case W.Float:o.getter=b,o.inputSize=4;break;case W.HalfFloat:o.getter=E,o.inputSize=4}}o.blockCount=o.height/o.scanlineBlockSize;for(let e=0;e<o.blockCount;e++)v(t,n);const l=o.width*o.height*o.outputChannels;switch(r){case W.Float:o.byteArray=new Float32Array(l),o.textureType=1,i&&o.byteArray.fill(1,0,l);break;case W.HalfFloat:o.byteArray=new Uint16Array(l),o.textureType=2,i&&o.byteArray.fill(15360,0,l);break;default:throw new Error("Unsupported type: "+r)}let s=0;for(const t of e.channels)void 0!==o.decodeChannels[t.name]&&(o.channelLineOffsets[t.name]=s*o.width),s+=2*t.pixelType;return o.bytesPerLine=o.width*s,o.outLineWidth=o.width*o.outputChannels,"INCREASING_Y"===e.lineOrder?o.scanOrder=e=>e:o.scanOrder=e=>o.height-1-e,4==o.outputChannels?(o.format=5,o.linearSpace=!0):(o.format=6,o.linearSpace=!1),o}(i,o,a,Y.DefaultOutputType);!function(e,t,n,r){const o={value:0};for(let a=0;a<e.height/e.scanlineBlockSize;a++){const i=w(n,r)-t.dataWindow.yMin;e.size=h(n,r),e.lines=i+e.scanlineBlockSize>e.height?e.height-i:e.scanlineBlockSize;const l=e.size<e.lines*e.bytesPerLine&&e.uncompress?e.uncompress(e):z(e);r.value+=e.size;for(let n=0;n<e.scanlineBlockSize;n++){const r=a*e.scanlineBlockSize,i=n+e.scanOrder(r);if(i>=e.height)continue;const c=n*e.bytesPerLine,s=(e.height-1-i)*e.outLineWidth;for(let n=0;n<e.channels;n++){const r=t.channels[n].name,a=e.channelLineOffsets[r],i=e.decodeChannels[r];if(void 0!==i){o.value=c+a;for(let t=0;t<e.width;t++){const n=s+t*e.outputChannels+i;e.byteArray&&(e.byteArray[n]=e.getter(l,o))}}}}}}(l,i,o,a),n(i.dataWindow.xMax-i.dataWindow.xMin+1,i.dataWindow.yMax-i.dataWindow.yMin+1,t.generateMipMaps,!1,(()=>{const e=t.getEngine();t.format=i.format,t.type=l.textureType,t.invertY=!1,t._gammaSpace=!i.linearSpace,l.byteArray&&e._uploadDataToTextureDirectly(t,l.byteArray,0,0,void 0,!0)}))}}}}]);