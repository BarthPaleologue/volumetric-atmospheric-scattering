"use strict";(self.webpackChunkvolumetric_atmospheric_scattering=self.webpackChunkvolumetric_atmospheric_scattering||[]).push([[118],{6194:(e,t,r)=>{r.d(t,{Qs:()=>m,SX:()=>_,LZ:()=>g}),r(8795),r(4344);var a=r(9178),s=r(9613),n=r(9725),i=r(7934),o=r(4091),l=r(2877),c=r(1038);class d extends l.${_gatherImports(e,t){e?(this._webGPUReady=!0,t.push(Promise.all([r.e(655).then(r.bind(r,655))]))):t.push(Promise.all([r.e(786).then(r.bind(r,1786))])),super._gatherImports(e,t)}constructor(e,t=null,r){super({...r,name:e,engine:t||c.N.LastCreatedEngine,useShaderStore:!0,useAsPostProcess:!0,fragmentShader:d.FragmentUrl})}}d.FragmentUrl="pass";class p extends l.${_gatherImports(e,t){e?(this._webGPUReady=!0,t.push(Promise.all([r.e(972).then(r.bind(r,2972))]))):t.push(Promise.all([r.e(141).then(r.bind(r,1141))])),super._gatherImports(e,t)}constructor(e,t=null,r){super({...r,name:e,engine:t||c.N.LastCreatedEngine,useShaderStore:!0,useAsPostProcess:!0,fragmentShader:p.FragmentUrl,defines:"#define POSITIVEX"}),this._face=0}get face(){return this._face}set face(e){if(!(e<0||e>5))switch(this._face=e,this._face){case 0:this.updateEffect("#define POSITIVEX");break;case 1:this.updateEffect("#define NEGATIVEX");break;case 2:this.updateEffect("#define POSITIVEY");break;case 3:this.updateEffect("#define NEGATIVEY");break;case 4:this.updateEffect("#define POSITIVEZ");break;case 5:this.updateEffect("#define NEGATIVEZ")}}}p.FragmentUrl="passCube";var u=r(7121);class f extends s.w{getClassName(){return"PassPostProcess"}constructor(e,t,r=null,a,s,n,i=0,o=!1){const l={size:"number"==typeof t?t:void 0,camera:r,samplingMode:a,engine:s,reusable:n,textureType:i,blockCompilation:o,...t};super(e,d.FragmentUrl,{effectWrapper:"number"!=typeof t&&t.effectWrapper?void 0:new d(e,s,l),...l})}static _Parse(e,t,r,a){return o.p.Parse((()=>new f(e.name,e.options,t,e.renderTargetSamplingMode,e._engine,e.reusable)),e,r,a)}}(0,i.Y5)("BABYLON.PassPostProcess",f);class h extends s.w{get face(){return this._effectWrapper.face}set face(e){this._effectWrapper.face=e}getClassName(){return"PassCubePostProcess"}constructor(e,t,r=null,a,s,n,i=0,o=!1){const l={size:"number"==typeof t?t:void 0,camera:r,samplingMode:a,engine:s,reusable:n,textureType:i,blockCompilation:o,...t};super(e,d.FragmentUrl,{effectWrapper:"number"!=typeof t&&t.effectWrapper?void 0:new p(e,s,l),...l})}static _Parse(e,t,r,a){return o.p.Parse((()=>new h(e.name,e.options,t,e.renderTargetSamplingMode,e._engine,e.reusable)),e,r,a)}}function m(e,t,r,a,n,i,o,l){const c=t.getEngine();return t.isReady=!1,n=n??t.samplingMode,a=a??t.type,i=i??t.format,o=o??t.width,l=l??t.height,-1===a&&(a=0),new Promise((d=>{const p=new s.w("postprocess",e,null,null,1,null,n,c,!1,void 0,a,void 0,null,!1,i);p.externalTextureSamplerBinding=!0;const u=c.createRenderTargetTexture({width:o,height:l},{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:n,type:a,format:i});p.onEffectCreatedObservable.addOnce((e=>{e.executeWhenCompiled((()=>{p.onApply=e=>{e._bindTexture("textureSampler",t),e.setFloat2("scale",1,1)},r.postProcessManager.directRender([p],u,!0),c.restoreDefaultFramebuffer(),c._releaseTexture(t),p&&p.dispose(),u._swapAndDie(t),t.type=a,t.format=5,t.isReady=!0,d(t)}))}))}))}let P,w;function g(e){P||(P=new Float32Array(1),w=new Int32Array(P.buffer)),P[0]=e;const t=w[0];let r=t>>16&32768,a=t>>12&2047;const s=t>>23&255;return s<103?r:s>142?(r|=31744,r|=(255==s?0:1)&&8388607&t,r):s<113?(a|=2048,r|=(a>>114-s)+(a>>113-s&1),r):(r|=s-112<<10|a>>1,r+=1&a,r)}function _(e){const t=(32768&e)>>15,r=(31744&e)>>10,a=1023&e;return 0===r?(t?-1:1)*Math.pow(2,-14)*(a/Math.pow(2,10)):31==r?a?NaN:1/0*(t?-1:1):(t?-1:1)*Math.pow(2,r-15)*(1+a/Math.pow(2,10))}(0,a.Cg)([(0,u.lK)()],h.prototype,"face",null),n.$._RescalePostProcessFactory=e=>new f("rescale",1,null,2,e,!1,0)},7413:(e,t,r)=>{r.d(t,{d:()=>c});var a=r(7881),s=r(7233),n=r(7167),i=r(3049),o=r(4491);class l{constructor(e,t,r,a){this.name=e,this.worldAxisForNormal=t,this.worldAxisForFileX=r,this.worldAxisForFileY=a}}class c{static ConvertCubeMapTextureToSphericalPolynomial(e){if(!e.isCube)return null;e.getScene()?.getEngine().flushFramebuffer();const t=e.getSize().width,r=e.readPixels(0,void 0,void 0,!1),a=e.readPixels(1,void 0,void 0,!1);let s,n;e.isRenderTarget?(s=e.readPixels(3,void 0,void 0,!1),n=e.readPixels(2,void 0,void 0,!1)):(s=e.readPixels(2,void 0,void 0,!1),n=e.readPixels(3,void 0,void 0,!1));const i=e.readPixels(4,void 0,void 0,!1),o=e.readPixels(5,void 0,void 0,!1),l=e.gammaSpace;let c=0;return 1!=e.textureType&&2!=e.textureType||(c=1),new Promise((e=>{Promise.all([a,r,s,n,i,o]).then((([r,a,s,n,i,o])=>{const d={size:t,right:a,left:r,up:s,down:n,front:i,back:o,format:5,type:c,gammaSpace:l};e(this.ConvertCubeMapToSphericalPolynomial(d))}))}))}static _AreaElement(e,t){return Math.atan2(e*t,Math.sqrt(e*e+t*t+1))}static ConvertCubeMapToSphericalPolynomial(e){const t=new n.O;let r=0;const a=2/e.size,l=a,c=.5*a,d=c-1;for(let n=0;n<6;n++){const p=this._FileFaces[n],u=e[p.name];let f=d;const h=5===e.format?4:3;for(let n=0;n<e.size;n++){let m=d;for(let l=0;l<e.size;l++){const d=p.worldAxisForFileX.scale(m).add(p.worldAxisForFileY.scale(f)).add(p.worldAxisForNormal);d.normalize();const P=this._AreaElement(m-c,f-c)-this._AreaElement(m-c,f+c)-this._AreaElement(m+c,f-c)+this._AreaElement(m+c,f+c);let w=u[n*e.size*h+l*h+0],g=u[n*e.size*h+l*h+1],_=u[n*e.size*h+l*h+2];isNaN(w)&&(w=0),isNaN(g)&&(g=0),isNaN(_)&&(_=0),0===e.type&&(w/=255,g/=255,_/=255),e.gammaSpace&&(w=Math.pow((0,s.OQ)(w),i.tk),g=Math.pow((0,s.OQ)(g),i.tk),_=Math.pow((0,s.OQ)(_),i.tk));const b=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const e=Math.max(w,g,_);if(e>b){const t=b/e;w*=t,g*=t,_*=t}}else w=(0,s.OQ)(w,0,b),g=(0,s.OQ)(g,0,b),_=(0,s.OQ)(_,0,b);const E=new o.v9(w,g,_);t.addLight(d,E,P),r+=P,m+=a}f+=l}}const p=4*Math.PI*6/6/r;return t.scaleInPlace(p),t.convertIncidentRadianceToIrradiance(),t.convertIrradianceToLambertianRadiance(),n.Q.FromHarmonics(t)}}c._FileFaces=[new l("right",new a.Pq(1,0,0),new a.Pq(0,0,-1),new a.Pq(0,-1,0)),new l("left",new a.Pq(-1,0,0),new a.Pq(0,0,1),new a.Pq(0,-1,0)),new l("up",new a.Pq(0,1,0),new a.Pq(1,0,0),new a.Pq(0,0,1)),new l("down",new a.Pq(0,-1,0),new a.Pq(1,0,0),new a.Pq(0,0,-1)),new l("front",new a.Pq(0,0,1),new a.Pq(1,0,0),new a.Pq(0,-1,0)),new l("back",new a.Pq(0,0,-1),new a.Pq(-1,0,0),new a.Pq(0,-1,0))],c.MAX_HDRI_VALUE=4096,c.PRESERVE_CLAMPED_COLORS=!1}}]);